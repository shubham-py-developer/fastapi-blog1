{% extends "base.html" %}

{% block content %}

{% if request.query_params.get('alert') %}
    {% set parts = request.query_params.get('alert').split('|') %}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        Swal.fire({
            icon: '{{ parts[0] }}', // success, warning, error, info
            title: '{{ parts[1] }}',
            timer: 2500,
            showConfirmButton: false,
            position: 'top-end',
            toast: true
        });
    </script>
{% endif %}

<div class="container mt-4">
    <h2>Your Blogs</h2>
    <a href="/user/blogs/create" class="btn btn-success mb-3">Create New Blog</a>

    {% if blogs|length == 0 %}
        <div class="alert alert-info">  
            You have not created any blogs yet.
        </div>
    {% else %}
        {% for blog in blogs %}
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <h4>{{ blog.title }}</h4>
                    <p class="text-muted small">Slug: {{ blog.slug }}</p>
                    
                    <!-- Render sanitized HTML content -->
                    <div class="text-secondary">
                        {{ blog.content | safe }}
                    </div>

                    <div class="mt-2 d-flex gap-2 flex-wrap">
                        <a href="/app/blog/{{ blog.id }}" class="btn btn-primary btn-sm">View</a>
                        <a href="/user/blogs/{{ blog.id }}/edit" class="btn btn-warning btn-sm">Edit</a>
                        <form action="/user/blogs/{{ blog.id }}/delete" method="post" style="display:inline;" class="delete-form">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.querySelectorAll('.delete-form').forEach(form => {
    form.addEventListener('submit', function(e) {
        e.preventDefault(); // prevent default form submission
        Swal.fire({
            title: 'Are you sure?',
            text: "This will permanently delete your blog!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit(); // submit form if confirmed
            }
        });
    });
});
</script>

<style>
body {
    background-color: #f5f7fb;
    font-family: 'Poppins', sans-serif;
}

.card { transition: all 0.3s; }
.card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.12); }
.btn { border-radius: 25px; }
</style>

{% endblock %}
